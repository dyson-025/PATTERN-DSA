ğŸ§  Problem Essence

You have a big rectangle with fixed outer borders.
Inside it, some horizontal and vertical fences exist.

By removing some fences, you want to form the largest possible square.

ğŸ”‘ Key Idea

A square is defined by:

Two horizontal fences â†’ vertical distance = side

Two vertical fences â†’ horizontal distance = side

So the side length must appear in both:

horizontal gap
=
vertical gap
horizontal gap=vertical gap
ğŸ§© Trick

Include the boundary fences (cannot be removed, but they form valid limits):

Horizontal positions: {1, m}

Vertical positions: {1, n}

Now the problem becomes:

From all horizontal fence positions, pick two â†’ get height
From all vertical fence positions, pick two â†’ get width
Find the maximum common value between these two sets of distances.

ğŸ›  Algorithm
Step 1 â€“ Add boundaries
hFences += {1, m}
vFences += {1, n}

Step 2 â€“ All possible horizontal distances

Store:

âˆ£
â„
[
ğ‘–
]
âˆ’
â„
[
ğ‘—
]
âˆ£
ğ‘“
ğ‘œ
ğ‘Ÿ
ğ‘
ğ‘™
ğ‘™
ğ‘–
<
ğ‘—
âˆ£h[i]âˆ’h[j]âˆ£foralli<j

in a HashSet.

Step 3 â€“ Check vertical distances

For every:

âˆ£
ğ‘£
[
ğ‘–
]
âˆ’
ğ‘£
[
ğ‘—
]
âˆ£
âˆ£v[i]âˆ’v[j]âˆ£

If it exists in horizontal-set â†’ valid square side.
Keep the maximum.

â± Complexity

Let H = hFences size, V = vFences size.

Time: O(HÂ² + VÂ²) â‰¤ 600Â² â‰ˆ 3.6e5 (safe)

Space: O(HÂ²)

ğŸ“ Code Logic (Your Solution)
hFences.push_back(m);
hFences.push_back(1);
vFences.push_back(1);
vFences.push_back(n);

unordered_set<int> st;
for(int i=0;i<hFences.size();i++){
    for(int j=i+1;j<hFences.size();j++){
        int width = abs(hFences[i]-hFences[j]);
        st.insert(width);
    }
}

int maxs = -1;
for(int i=0;i<vFences.size();i++){
    for(int j=i+1;j<vFences.size();j++){
        int width = abs(vFences[i]-vFences[j]);
        if(st.count(width)){
            maxs = max(maxs,width);
        }
    }
}

if(maxs==-1) return -1;
return (1LL*maxs*maxs) % mod;

ğŸš¨ Important Notes

Unlike 2943, here we do not need consecutive fences.

Any two fences matter â†’ distances are key.

If no common distance exists â†’ answer = -1.

ğŸ§  One-Line Insight

Largest square side = maximum common distance between any two horizontal and vertical fences.
